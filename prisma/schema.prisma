datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id                Int            @id @default(autoincrement())
    email             String         @unique
    name              String?
    password          String?
    image             String?
    emailVerified     DateTime?
    Posts             BlogPost[]
    Comments          Comment[]
    BlogViews         BlogView[]
    Subscriptions     Subscription[]
    verified          Boolean        @default(false)
    verificationToken String?
    credits           Int            @default(0)
    createdAt         DateTime       @default(now())
    accounts          Account[]
    sessions          Session[]
}

model Account {
    id                String  @id @default(cuid())
    userId            Int
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       Int
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

model BlogPost {
    id         Int        @id @default(autoincrement())
    title      String
    content    String?
    excerpt    String?
    coverImage String?
    topic      Topic
    published  Boolean    @default(false)
    type       PostType   @default(FREE)
    authorId   Int
    author     User       @relation(fields: [authorId], references: [id])
    createdAt  DateTime   @default(now())
    Comment    Comment[]
    BlogViews  BlogView[]
    viewCount  Int        @default(0)
}

model BlogView {
    id       Int      @id @default(autoincrement())
    postId   Int
    post     BlogPost @relation(fields: [postId], references: [id])
    userId   Int
    user     User     @relation(fields: [userId], references: [id])
    viewedAt DateTime @default(now())

    @@unique([postId, userId])
}

model Subscription {
    id                Int       @id @default(autoincrement())
    userId            Int
    user              User      @relation(fields: [userId], references: [id])
    razorpayOrderId   String?
    razorpayPaymentId String?
    amount            Int       @default(100)
    status            SubStatus @default(PENDING)
    startDate         DateTime?
    endDate           DateTime?
    createdAt         DateTime  @default(now())
}

enum SubStatus {
    PENDING
    ACTIVE
    EXPIRED
    CANCELLED
}

model Comment {
    id        Int      @id @default(autoincrement())
    content   String
    postId    Int
    post      BlogPost @relation(fields: [postId], references: [id])
    authorId  Int
    author    User     @relation(fields: [authorId], references: [id])
    createdAt DateTime @default(now())
}

enum PostType {
    FREE
    PAID
}

enum Topic {
    TECHNOLOGY
    HEALTH
    LIFESTYLE
    EDUCATION
    ENTERTAINMENT
}
